# Standard Libs
import pytest
from unittest.mock import patch, MagicMock

# External Libs
from api.repositories.base_repositories.oracle.repository import OracleBaseRepository
from api.repositories.files.repository import FileRepository
from api.services.request_statement.request_statement import RequestStatement
from tests.stubs.project_stubs.stub_request_statement_pdf import request_bank_statement_pdf_dummy
from tests.stubs.project_stubs.stub_data import (
                                                    payload_data_dummy,
                                                    StubS3Connection)


@pytest.mark.asyncio
def test_generate_path_function_when_sending_the_right_params_then_return_the_expected():
    response = RequestStatement.generate_path(client_id=None,
                                              start_date=1646757399000,
                                              end_date=1648485399000)
    expected_response = 'None/statements/1646757399000-1648485399000.pdf'
    assert response == expected_response
    assert isinstance(response, str)


@pytest.mark.asyncio
def test_when_params_of_generate_path_are_none_then_raise_exception_error():
    with pytest.raises(Exception) as err:
        response = RequestStatement.generate_path(  client_id=None,
                                                    start_date=None,
                                                    end_date=None)
        assert err == response

pdf_response = b'%PDF-1.4\n%\xc3\xa2\xc3\xa3\n1 0 obj\n<<\n/Title ()\n/Creator (\xfe\xff\x00w\x00k\x00h\x00t\x00m\x00l\x00t\x00o\x00p\x00d\x00f\x00 \x000\x00.\x001\x002\x00.\x005)\n/Producer (\xfe\xff\x00Q\x00t\x00 \x005\x00.\x001\x002\x00.\x008)\n/CreationDate (D:20220502202241-03\'00\')\n>>\nendobj\n2 0 obj\n<<\n/Type /Catalog\n/Pages 3 0 R\n>>\nendobj\n4 0 obj\n<<\n/Type /ExtGState\n/SA true\n/SM 0.02\n/ca 1.0\n/CA 1.0\n/AIS false\n/SMask /None>>\nendobj\n5 0 obj\n[/Pattern /DeviceRGB]\nendobj\n6 0 obj\n<<\n/Type /Page\n/Parent 3 0 R\n/Contents 8 0 R\n/Resources 10 0 R\n/Annots 11 0 R\n/MediaBox [0 0 595.000000 842.000000]\n>>\nendobj\n10 0 obj\n<<\n/ColorSpace <<\n/PCSp 5 0 R\n/CSp /DeviceRGB\n/CSpg /DeviceGray\n>>\n/ExtGState <<\n/GSa 4 0 R\n>>\n/Pattern <<\n>>\n/Font <<\n/F7 7 0 R\n>>\n/XObject <<\n>>\n>>\nendobj\n11 0 obj\n[ ]\nendobj\n8 0 obj\n<<\n/Length 9 0 R\n/Filter /FlateDecode\n>>\nstream\nx\x9c\xb5SMK\x031\x10\xbd\xcf\xaf\x98\xb3\xd0l&\xd9L\x12\x10\xc1\xae\x1f (\x94]\xf0 \x1e\xa4\xb5J\xb1\xc5\xb5\x07\xff\xbe\xf9\xb2n\x17\n\x85\xe2\x06v2\xf3\xf2\xde\xbc]&\xd5m\xfb\x82o[\xac\x9a\xf6\x13\xe7%6-Ha\x8d\xcc\x0f\xc65\x19\x16\xfcn\x8fN+\xa1R\x82\xf35\xf4\xd8\xc3\x0cf\xe1\x1dc\x1fT<\x0fU\xc6y\xa0\xfc6\xce\x85\xed|\x03U\xb6\x04\xb9\xd26\x0f@\xf8\x1dvw\xa8\xf0>\xc4\x15>=K\xc4E\xe9\x14\x0f\xad\xc12\x0b\xe9\x82.\x87\xf4c\x98\x92\xf4FX\xb2\xaa\x0eu9N\xe3\xe1wx<\xc3M\xb2k\xd9ig\x88U\xb1\xbb\x9f\x9fj\xb7\xdf\xd1)\xad!\xfd\xa8\xee1xo\x91j\xc5\xf8\xf5\n\xcb z\xd8\xd1\x89\x1f4\xed\xa0\xba\t\xbd\x18\xbbe0\x9b\xa6 \x87n\r\x0e\'Jc\xb7\xc0\xf3\xf0\x93\xe9\x02\xbb\x15\x90\x14d\xc9\x85\xd1\x88G2\xa2\x12b\x856^\xc7\x99\xf9Ct\xe6\x90\xe01\xa7N\x88\x17\x92\x0c\xab=\x8eI\x08\x8bZ%\xca\x00\xe1\xd2\x87k9\xe2\xd8\xa2f4\xa59=F\xcd\x15\x0e\xe7\xc9>\xea{|B\x8c\xd0~\xec\xe0\xb2 \xd2:\xdaG\xa6\xc5\x81\xd2\xf5H\xad9\x88\\%\xe4\xba\x8b\xd3_n\xda?\xdf2\x9c\xc1\x0f\x89\x8d\xe1\x83\nendstream\nendobj\n9 0 obj\n334\nendobj\n12 0 obj\n<< /Type /FontDescriptor\n/FontName /QMAAAA+DejaVuSerif\n/Flags 4 \n/FontBBox [-769.531250 -346.679687 2105.46875 1109.37500 ]\n/ItalicAngle 0 \n/Ascent 928.222656 \n/Descent -235.839843 \n/CapHeight 928.222656 \n/StemV 43.9453125 \n/FontFile2 13 0 R\n/CIDSet 16 0 R\n>>\nendobj\n13 0 obj\n<<\n/Length1 10112 \n/Length 17 0 R\n/Filter /FlateDecode\n>>\nstream\nx\x9c\xc5Z}l[\xd7u\xbf\x97\xa2(GN\\\xab\xb6\xac\xc6m\xac+j\xb2\xec\xf8\x85rDK\xaa\xe5\xd6\r\xc5\x0f\x89\x16E*$%\xc7]:\xef\x89|\x14\x1fE\xf21\xef=JV\xbc\xa1\xdb\x8caK]\xdbm\xd3xp\x1a\xd4X\xe1v@1l\x81Q\x0c\x1d\xba\x18C\x81\xfeQl\xfd#\x0b\x8c\x0c]\x96 M\xbc\xb5\x03\xd6v\xc5>j,\xa6w\xee\xb9\xf7\xf1K\x8al\xa4\x1b&\x86|\xe7\xdd{\xee9\xbf\xf3y\xef{\x0e\xa1\x84\x90m\xe4wH\x07!\x89\xd4\xc8h\xe9O\x7f\xfeo0\xf2y\xf8..\x17\xd7s;f\xfe+\x04\xf4\xbb\x84\xb8W\xf3\x9a\x9a\xcdF\xa2_\'\xa4\xf3i\x18\x1b\xcf\xc3\x80\xe7\xec\xf6\x97\xe0\xfe\xcbp\xffk\xf9\x92}\xe6\xe8\xbe\xae\xc7\xe0\xfe\xdbp\xff\xf1\xa2\x91Q\x1f\xf8x\xd7\xdf\xc2\xfd\xcf\xe1~_I=S!=\xe4\x08!\x9e\x9dp\xcf\xcajI\xfb\xad/xa\xdes\x98\x90\x818\xa1\xee\xbd\xf4\x0b\xa4\x13\xf8\xfd\x9dW\x08\xa1\xfb\xc4\xb5\xe3u\x92s}\x98\x10\x97\xc7\xd3\xd1\xe9\xe9t\xb9\xdc\xb7\x88\xe7n\x92\xdc\xfe\xefn7a \x89\xcc\xe7\xc2Y\xf2\x04aw\xefzv\xd7v\xd3\x17\xbbJ\xf4\x9d\xdf$\xe4\xea[\xaf\xf3Y\xe2"\xb9\xdaew\xae\xf3\x1aX\xd9E\xc8\xae\x9e\x81\x9e\xa1\x81\x9e\x81\x9c\x9b\xbcgu|\xf4\xbd[\xb5\xcb];~\xf9\x0b\xd3s\x90PJj\xd7\xdd}\x9e\xddD\x01\x14\xbd\x83\xde\xe1\xfd\x13=G\x86\xf7\x0f\x0e\x8e\xf9\xf7L\x8c\x8f\xf5\xec\x9f\x18\xf7\xfb{\x07=]\x9e\xbe\x1e\xf8\xe9\xda\xd3\xb7\xa7\xb7\xc7\xd3\xb7\xc7\xef\xee;~;\xbdH\xc7\xc7/~\xf2\x93\x17\xc7\xc7\xe9b\xfa\xf6\xf1\xd0\x85C\n\xa5\x8f\x8f\xfe\xde\xb9\xd1\xc7\xa9r\xe8\xc2-\xfdD\xf4M\xeaz\xe1\xd8\xa4N\x8fM^\xa6\xae7f\xa3yzH\xb9P{\xfbj0\xb4op*\xf4R\xed\xed\x8b\x87\x14\x8e\xf8\xfb\x1d\xdft\xdd\xea\xbc)\x10\xd3\x9eA\xc0<\xd8C\xf3W]\x1f\xbb\xday\xf3\xceM\xd7!\xfe%\x94<\x83\xde\xbaI\xfa\x08\xf1\x8f\xf9{\x06\xc7\x06\xf0; i~}\xe6\xc6\r\xf7\xf5\xb3w\x92\xf4\'g\xcf\xd6\xfa\\7\xce\x16:\xc9J\xed[\xaf\xd6\x1e\xfcNm\xe7w\xee\\z\xb5\xf6-PA\x1e\x86\x18\x17\xdc\xc3\xe4\xa3p\xb3\x0b\xd6\xf6\x0eR\xea\xef\x05\x01\x1d\x1dx\xa1\x14\x07]\xe9\xb7.\xd1+\x17j\xef\xd0\xd8\xf9Z\xef\x1f\xfc\xf3\x8f?W+^\xa0C\xb5W\xce\xd1\x7f\xf8\xac\xeb9\xea_Y\xa9\xad\xd5&\n\x05z\xbc\xf6]\xf8\xfd2\xbd\xb1\xb2\xc2\xe5\x1f\xbb\xfb\xa3\x8e\xe1\xceg\xb8|\x10\xef\xef\xf1\xf7\x0c\xf4\x0e\xf4\xec\x06\xdf\x81g\'\xfc\xe0\xcdap\xf7\xd8?~\xedk\x7fI?]\xfb\xc6\xde\x87\xa7g\x06\x06\\\xe7\x1f\x88L\x7f\xf1\xea\xd4T\xc7_\xad\xd0\x13\xb5\xbfX\xb9\xf3\x99?\x1c\xdaO\x95GO\x7fi*D\xa7\xc3\xdf\xe4\x92O@\x8e\xbc\xe6\x0e\x91\x8f\xa1\xa7\xf6C\xb8\xbc<>\x88\x9a{\xa1w\x1c\x14\x8c\xf6\xed\xe9x\xad\xd09<<\xfb\xdc\xf4\tz\xf3\xce\x0f\xbe\xf12\xcd\x8f-.<\xfb\xd8\xe8a\xf7\xc1\xda\x7f&\x86\x87\x7f\xe3\xf4\x9f\xd7\xf6\x16\n\x1di\xfd\x15c\xfc\x08\xed\xda\xc63\xe7\xee\x8f\xdc\xe7A\xf6Cd\x14\xa4\x8fa\xe49\xe6\xd1\x89\xf1]\xa8\x01\x06\x06=\x80\xfb\x08d\xc6\xc0\x18\xcf\x15\x9e\x17\x83c\x8e\xce\x91\x7f}.\x18\xa2\xa1`\xd5\x9a\x8e|\xfbZ\xed\xda\xf1\xc4\x93\x85\xeb\xcb\xf9\xb5\xd5\x1fRW\xf4\xc4\xef\x1bO\x04v\x9e>\xfd\xf4\xa7\x17\xdf\xa8Z4\xfe6\x9d\xfc\xc4z\xe5\x89\xc0t\x84\xber\xe7\xef\n\xd6\xacw\x90\x9e\xfe\xcc\x1f_{\xfa\xd7\xa3gBS\xf4q\xbf\xfa\xfa\x81=\xbbh\xc9\x90\xc8\n\x80\xecC\xa4\x9f\x90!\xc0\xc3\x95\x0fs|\x90\x8f}\x0e\xa4QNwy\\\xf9\xe7\xe7fg\xe7\x9e\x7f\xe1\xc4\x1c\xa5s\xb1\xe7\x7f\xf2\xf9\x0b\x17\xce\xff\xcb\x8f/\x9e\xa7\xf4\xfc\xc5H\xb5\xfa\xee\xbb\xa0\x9eZ\xfcZ\xcd\xd0\xaf\\\xa9\xddy\xf1\xca\x95\x17\xef\xd4\xae|\x054\xdd\xbc\xfb\x0e}\xabc]h\x9ah\x92\xca\xeb\xa3\x07\xee\'\xf64\xeeo\x0e\x0f\x1d\x9d80D\xe9\xd0\xfe\xa3\x93C\xfb\xe1\xee\xe8~qwth8?q`x\xf8\xc0\x04P\xc3C\xae\xef\xb5\xb0A\x1c_\xae\xfd\xc2\xf5\xbbP{\xbcFyn\xc0\xf7e\xfaj\xed\xa7\xf4\xc3\xb5\x11\xcf\xee\xc2\xed\xeb\x05\x1e\xed\xaf\x02\x97!\xb8(\xe47\xcfq\x97Q\x1b\x01\xa6\x9fzv\xff\xf2\xcd\x82\'^h\xabc\x1e,,\xdd\t\xc8\x8d1\xa7\x9e\xb9\r<\xfd&\xa0\x9e!_zy=\x0f\x0eR\x129\xaf<JG\x1f?w\xee\xf0\xe8\xa3\xca\xf9\xc8\xa7n\xa7\x93t|\xec\xd2\xf1\xe3\x97\xc6\xc6i2}\xfbS\xb7\x94G/\xd1\xfe\x97BS\x83\xfbB\xc1\xab\xb4\xff\xa2r(\x1f\x9d}\xa3V\xbb<y\x8c\xea\x93\xc7^\xa8\xd5\xde\x8cBN\x12*\xbe\xbe\xbdO\xf5\x9f\xfe\xd0\'\xfe\x837\xda\x8d\x7f\xb5\xcb\x9d~\xc0I\x89\xa7>\x04k\xbaJ\xb5G\x084\xcb\xdb\x7f\xff^\xa5\xd3\x8f\x92\x9a\xffv\xb8\x7f@r\x9d}\x94t\xfc\x19\xf9~\xe7\xeb\xe4\x19\xf79\xf2p\xc7\x049\xd6\xf1\x1a9\xe1\xfe\x1e\xc9\xb9_\x85\x9ey\x9d\xdct\x9d\x87\xda\xe8\'/\xc3\xf7\xab\x9c\x1f\xfez\xc9)R"_"\xdf%?\xa3\x8f\xd0\x02\xbdJ_\x83\xcf?\xd1\xdb\xaec\x12\xf3\x0e\xe2\x87\xa8K$\x1b\xfe\xf6\xd2\xe3\xf5\xf1\xd3\xe4\xaf%M\xc9\x83tR\xd2.\xe2\xa6OJ\xba\x03\xc6+\x92v\x03\xfdG\x92\xee\x04\xfa\x86\xa4=d;}G\xd2\xdbH\x8fk\x97\xa4\xb7\x93G\\\xaa\xa4\x1fz\xe0\xf9\xde?\x91\xf4\x0er\xa4\xff\xeb\x92\xdeI\x1e\xec\xffwI\xf7\x107\xdb\x0e\x1a\xa9\xfb\x01\xb8\xbb\x81\xda9M\xc9G(\x93\xb4\x8bl\xa3\xd3\x92\xee\x80\xf1EI\xbb\x81\xfemIw\x02}M\xd2\x1e\xb2\x87\xfe\x8d\xa4\xb7\x11/\xfd\x99\xa4\xb7\x93I\xd7\x90\xa4\x1f\xda\xb5\xdf\xf5YI\xef \xf9\xfec\x92\xdeI>\xd2\xffCI\xf7\x90m\x8c\x92 1H\x85\xac\x13\x93\xe8d\x99\xe4\x89\r\xfb\xd7\x01\x92!\x07\xe1:J\x0e\xc3\xc7\x0f\xd4\x12p02\x05<6\xb1\xe0k\x12\x8d\xa8\x103\x05F\xa3\xa4\x0c\xfc>\xa0\x02\xa4\x08\x1fF\x92uY\x16\xdeip\xd5`\xcd*\xfcf\x81\xb3\x9b\x84\x80*\x80\x84ER\x05\x8e\x0c\xf0\xaa e\x199\x19\xd0\\>\x03)e\xf8\xad\x00\xcf\x12\xc8\xd5\x81\x8f\xc1z\x03\xf4\xaa8\xd7MH\xd0\xa8\xac\x9b\xfar\xdef\x072\x07\xd9\xe8\xe1\xc3~\xb6\xb4\xce\xa6t\xdb\xb2MM-),Z\xce\xf8X\xa0XdI\xcee\xb1\xa4fi\xe6\xaa\x96\xf5u\x87\xb4\x82\xbaXe\x99\xbcZ^\xd6,\xa6\x9a\x1a\xd3\xcb\xacR]*\xea\x19\x965J\xaa^\x06\x05\xadHSh\x87Nr0!\x96\xa74S\x87\xbb)\x80e\x10\xd8U\xa6\x0cc\xe5\xbeW\xdd\'\xdb"NX0e\xa0GF\xc1\x87~2\x01\x13\x9ai\xe9F\x99\x8d\xfa\xfc\x13\xad\xd26\xc8\xdaTc\x0e\x05\x8a0\xd92\xa4\x8e\xee\x9cQ\x06w\xd9\xe0D\x82\xa1\xb4!\x10\x93d\x04>Y)c\x15d\xf8`\xad\x01W\x13\x82\xa3\xa1<\x13\xc3\xe8\x03\xb9\x1a\xac!y\xdb\xaeL\x8e\x8cdA\xe8j\xd5g\x19U3\xa3\xe5\x0csY\xf3\x955\x98\x8e4!p\xc2\xee\xa4\xdf\xc6t\xe3s<\x954LI\r\x92\xc2 k\xc0\xcb\x93\xef\x7f\'\xa5xrvo\xaaY\x04A\x05\xaa\x19\xf3\xc6\xf2\xe9&\x8f\xfd\n\x1f\xae\xfd\xff\xa3$7\xf7v\xc3f]z\x91\xe1\xbc\x8a9PB\xaf\xae\xc0\x98\x01\x91\xbf\x17\x16n\xd9<\xca+\xa1\xb4F:\x0b\xd9y\x9c\xd3\xa4]\xcb\xa8\xa5\x8cY\x99E99\x9c\xd5\xea\xdaD\x84E\xb6)\x88\xcb@\x84e\\_\x91%#4\x18 \xd5\x96\x11\xd61+\x84-\x19\xe9iG\xa6\x8d(Z\xebB\x05\xae\x0cfHEJw$pn\x81]d\x92\x06\xe3\x96\xcc`oS\x96x1r|m\x16\xaf\x16\xe2\xca\xc0\x1aU\xda\'r0\x03YYB)6\xce8\xfe\xc9\x01U\x94y|\xa0\x8e\xb1\xa1\x81w\x0e\x8e\xdf\x86Z\x10y\xce56|\xc2G*\xf0k\x80\x96*\xe2l\xa0\xc9\xa2\x056\xe6\xda\x12\xcc\xda8\xeb\xe8x\x7f\r\x8a\xac\xa5\x0c \xab\xa2\x14\xe1\x935\xcc\x81<\xf6\x04[z\xa6\x84c\xcd\x169\xf2\xcd\x96\xac\x14h\xab\xe8C\xa5):\x9c.a<\x9dX7\xea\xd7\x82\xd5\xca\xfb\xd8\xa1\xd4\xed\x1c\xc1\xbe\xc4P\xb2\xa8\x07![\x97^m\x8d\xfe\xd6V;\x9e\x13h+\xf5\x8c\xb6\xdb\xb2\xaea\xd1\x1a\xfa\xa3t_\x1a\x9cj\xc8aO-K\x0b\xb5&\x8dY\xfc\xe5:\x14\xbcrO\x14\x80#\x83\xf2\x04Os\x1e\x17e\x97t"\x94A\xddYD\xacK\xa4\x93X\x9di\xb9J\x05\x89\x06v\x86F\x0c\x9a{Q\xc3\x03\x1b;A\x19\xf8mY\rV\x0b\xafS+\r\x8f5\xf7\x80\xe6u\x0cmVe\xa4\x96\xea}\xdb\xc95\xe1\r\xd1\xc9\xd5-\xe2i\xe0\x1e\xc4d\xecKxm\xf4\x8f\xfb\x89\x85\r\x96Wp_S\xa5E\xbe\x16Om\xb5\x96\xfbd\xbd\x8e\xbf\x84\xd5\xa7c-;\x1d\x8dc\xb7e\xd7\x13#\x02)\xf7i\xb6)\xe6\xcdY\xe7\xec_\\\x8b\xf0W\x15\xa4\xa8\xb8\xce\xb1(\x8bHy\xbc\xcaM\xdeX\x06>nM^\x8e\x99M=T\xc5\xec\x11\xb9\xeb\xe8h\xf7\x8fuO\x9b\x9a{\\\xb6%\xc3T\x8c\xd1f\x08\xb6F\xd2\xaa\xaf\xdd/\x9baTd\xdc\x8b\xb8N\xdf\xa2\xab\x9b\xb2\x03i\x88\xaf\xd4"\xd7\x19\xb1\xea\x99\xe9\xd4M\xfb.\xa2\xc9~\xa7\xb5D`\r\xad\xca\xe2z\xef&\xfb\xa2\xb7nw\xfb\n\xce\xef\xec\xba\xde\xa6l\x13\xb5\x13k\xdbg\x96\xb0\xee\x8d&\xacUY\x0fN$VaV\xdf\xc4c\x1a9\x83~.\xcb\x8a\xae\xc0G\xecb*vV\xad\xbe\xa29\xfe\x02\xf3\xd6\x15\x93\xc7N\xcf\xf0jI\x8c\x1af\xd4\xfb\xe7\x8b\xb0n\xb3\x1e\xceg\xab\xc8\xd5\xea\xe1\xcd\xbc\xca\x9a<\xd7\x1c\xc3\x0fZ\xb3\x16vOg\xcfnT\x9dSQ\xfc\x04Q\xac\x9fAL\xb9\xa2Ub\x053z\x05~\x97e\xc4\xc4\xbeXF\xdf\xb6\x9f?\xfe/:\xd6\xfb[\xb5$k\xc4\x96\xfbb\xae\xee\xa9\x19\x12F=\t\x12\x87;\xae\'\x01wir\x12\xce\x93I\x9c\x8b\xc2\x18\x83\xf3\\\x12f\x16\xe1.\x04\xa3!\x8cK\x00g\xf8\xbc\x17\xab\xf1$\xd0\\b\x82,\xa0,!#\t\xbf\\\xf6)\x18\xe1\xb2\x19\xde\xf3\xbbY\xe0\x8f\x83,\xbe6L\x9eB\x1da\x90\x96B\xce$\xca\x9e\x83\xd1\x18\\\xc3\x92\x8f\xaf\x08\xc2\xc8\x02\xdcsz\x9a\xf0\xd3\xa8\xd0\x17\x87Ui\xac\x1d\xbe\x8ec\x11H\xd30\xde\xd0\xda\x8a*\x8a\x1a\x1ddsp\x97\x04\xf93r6\x00\xb2\xa3(\x8f\xe3W\xd0S\x9c\x8e\xd7qF$\xd2\x00\xfa\x88K\xe62\x83\x80(\x86w|t\x01\xae\xf3\xc0\x97B\x7f\x06\xd0f\x816\x8e6D`^\xd8\x12F\x04"\x12\x02Q\x10\xae\xf3\xa0\x9bsL\x03\xae4\xa2\xe0\x9a\xd2\x92SA\x0b\xb9=!\\\xcf\xb5\xce\xe2\xa8@\x96\x90Q\xe6tC\x8aO\xfaR\xe0\xe0\xfe_\xackN\xa1\xfd1\xf80\xb4?\r#i\x8cM\x00\xe4;r\x9d\xdc\x99F\ts\xf5<Z@\xfb\x02\xe8\x87\x04j\x98\xc29\xeeE\xee\xcfX\x9d3\xd9\x14\x95 \xfa\x8b\xc7\x8d#\x0f\xa1\xa6\x00z$\xb5\xa9%\x8e\xb4\xd6\xe8l\x96\x1d\x8e\x86i\xb4/\x8c\x9e\x8a!w\n\xfc\x18\x06\xfeh}D\xe4c\x14m\rJ\xdf\n\x99"\xefEN\xc4\x9a\xbc\x1bD\x1byd\x9f\x04\xada\x99S\x01\xf4]\xab\x15\xa2B8\xfe\x86\x15"\x02\x01\xf9\x1bl\xf2Y#\xfaq\x19\xdd`=\xd6\t\xcc\xb2\x8d^9\x89\xb5\x18F\xae\x00\xc6:U\xf7B\x04\xebwN"_h\xca0\'\x8e\x0b2?\x13ud\xad\xfeu\xea\xc8\xe1\xbb\x9f\xde!d9\xba[#\x18\xc2|\x8aI\x84\xa9\xba7\xee-W\xf4\xae0\xeck\x19|\xde\xb1\xeb}\xbbu\xe7n>=6N\xa5\xcd\xe7O\xa5\xa9\xd76\x9f\x04D\x17\x9eF\xdeR\x1b_cT\xf4g\xb1g5\x9ey\x9a\xcfp\x9b\xed\\\xceS\xb28\xd37N\xbf\xce\xe9C\xf4n\xf1l\xd4|\xfa\xcd\xe29]\x9c\x05\xad\xfa\xa9D\xec\x1fF\xfdd\xb2\x86\xb3\x8d=]<\r\x96\x90\xa3\xf9y\xcfB\xbd\xc2\xb2\xaa\\\xd1.K\x9c/U<-pm\xd6&\xde\xdcj\x87j\x7fB\xac\xe0~/\xb4\xac!m\xcb\x93\t\xb7\xaf*y\xf9\xf8\xb3mO\xc5f\xdbS\xd5\xbdb\xe0\xd8r/\xff\x9b\x18\xef\x8a|\xa6\xd2\xd1\xc3\xfc<\xe9\x93rM\xe2<\x9f5|\xc2= \xde~\x95\xda\xa2\xde\xc8>.m\x92\xb4\x9fC\xb9\x0f\x96\x9b\x90ge\xc4\xc5\x9b4\xae\xb3\x9b\x90\x08\xbe\x8c\xe3\xaf(\xf9k\xce\xfa\xebMv\xc0\xd24\xb6\xa4\x15\x8d\xb5\x83>v\x1f/4}\xdd\xdd\x8d\xc5\x8b\x9a\xa92!\xb9\xfe\x1a\xb5\xfb\xb1-\xff\xba\xbb?\xf8\x0bW\xd6\xa6Y\x07\x88\xcc6\xd5\xacVR\xcd\x15f\xe4\xda\xa5tw\xcfkfI\xb7\xf0\x15\'p\xe75S\x03]\xcb\xa6Z\xb6\xb5\xac\xc2r&\x18\x0f\xcb\xc0`sYS\x98m0\xb5\xbc\xce*\x9ai\xc1\x02c\xc9\x06\x83\xf5\xf22h\xc9\x00h\xcei\xe75\xf9^S\xcdd\x8cR\x05\xd89\x83\x9d\x07\xe9\xe0$\xadl\x81\x83\xbd\xe8\x12\xefA\x10\x96e\xaae\x19\x19]\x05}\xe0\xc1L\xb5\xa4\x95m\xd5\xe6xrz\x11||\x80K\xc4\x05,e\xe4\xec5\xf0\xb9\xf7 "1\xb5\x8aid\xab\x19\r\xc5du0L_\xaa\xda\x1abhY\xa0@\x942\xc5j\x96#Y\xd3\xed\xbcQ\xb5\x01LI\x97\x8a8\xbf)\\\tb\xab\x16\xf0ss\x14V\xd2\xd0j\x8c\xaf\x95W\x9at(\\\xe7\x88a2K\x838\x00\xb7\x0eP\xa5\xf9m\xaa98\x10[\xe1\x8e\xb6\xa5\xebP\xd1Z\xde(m\\\xc0\xc3\x90\xab\x9aeP\xa8\xe1\xc2\xac\xc1,CaVu\xa9\xa0el>"|\\\x84\x94\xe4\x06e\x8crV\xe7vX\x93\xdd\xddi\x98R\x97\x8cU\r-\x10Y\x84\x00\xeaIP6l\x08\x83%FyT*\x8d\x0c\x10s\xcc\xca\xab`\xd4\x92&\xbd\x060 \xc9\xd5\x16;\x8d2\xe4\x85\xc9J\x86\xa9mj6\xb3\xd7+ZN\x05E>\x01\xaau\xb6\xa4\xaes\xf9%#\xab\xe7t\x9ehj\xd1\x86\xd4\x03\x02\x84\xaa\xd9,Z.\\\xc7\xebK5\x01W\xb5\xa8\x9a\xa8(\xabY\xfar\x19a,\x17\xd7+y\x8b/\xe2\x19\xaaf@\x88\xc5W8x\xacvM"\xe3\xb2\xc2aj\xb1I@\x9b\x10\xb9\xce\xc1\xd2\x90\x08\x10\xcb\xc5u\xa6\xb7\xa4:\x98dj\xfc\x7fm@^NX\xdc\x99<6N\x89h\x90w\x9a0`\xcd0\xb3\x16\xf3\xd6k\xd1\xcbu;\x13\xcc\xcbK\xd7\x8bn\x83\xe8\xc4d\xcd,iPM\\j\x15\xe2\xc0\x8dX5\xf4:0\xed\x8c\rU\xc3\xd4J\x05JL]*j|B\xd8\x0f\x92\xdb\x02\x93Wm\x96W-\x90\xa8\x95[\xfd\x02\xea\x1a\x19\x9ee\xd5rV\x02\xf6\xb6\xf6\x15\xaf\xb0p\xab\xc8ZF\x91W6\x86\x8e\x07JeE\xdeA\xa0^\x1c\xc6\x8a\x9aYQ\x97\xc10\xa8\xc5\xb2Q\xef\x1f\xf7\x9fX-\xaa\xa0i\x01D\xad\x98\xe3\xa0f\xc2,\x92\x88\xa7Y*\x11I\x9f\x0c$\xc3,\x9ab\xf3\xc9\xc4b4\x14\x0e1o \x05\xf7^\x85\x9d\x8c\xa6g\x12\x0bi\x06\x1c\xc9@<}\x8a%",\x10?\xc5f\xa3\xf1\x90\xc2\xc2O\xcd\'\xc3\xa9\x14K$Ytn>\x16\r\xc3X4\x1e\x8c-\x84\xa2\xf1i6\x05\xeb\xe2\x894\x8bE\xe7\xa2i\x10\x9aN\xe0R)*\x1aNqas\xe1dp\x06n\x03S\xd1X4}Ja\x91h:\xceeF@h\x80\xcd\x07\x92\xe9hp!\x16H\xb2\xf9\x85\xe4|"\x15\x06\x19!\x10\x1b\x8f\xc6#I\xd0\x12\x9e\x0b\x83\x11 (\x98\x98?\x95\x8cN\xcf\xa4\x15X\x94\x86A\x85\xa5\x93\x81Px.\x90\x9cU8\xc2\x04\x98\x9cd\xc8\xe2\x03\x94 \x83\x85\x17\xf9\xe2\xd4L \x16cS\xd1t*\x9d\x0c\x07\xe68/\xf7\xcet<1\xc7}\xb4\x10\x0f\x05\xd2\xd1D\x9cM\x85\xc1\x94\xc0T,,\xb0\x81)\xc1X :\xa7\xb0P`.0\x1dN5\x94p6iN\xc3\x1d|\xc1t8\x1eN\x06b\nK\xcd\x87\x83QN\x80\x1f\xa3\xc9p0\x8d\x9c\xe0{\xf0D\x0c\xe1\x06\x13\xf1T\xf8\xc9\x05\x18\x00>G\x05\x04d&\x8c*\xc0\x80\x00\xfc\x17Ddh~\x1c\xcc\xe5r\xd2\x89d\xba\x0e\xe5d4\x15VX \x19Mq\x08\x91d\x02\xe0\xf2x\xc2\nn\xe3\x02\xf8\x93\x07/.\xf1\xf2\x18\xf1\xb1\x8d\xd9\x01\\|\xb540\x14\x0e\xc4@`\x8a\xc3\xd8\xc0\x0b\xd9\x15>\x93\xd1*6\xcfmY\xdc\xa2=b+\x15\xfdS\xc1\xac\x15M\x00Rx\xba\x0c\x85+\xc6\x90\x84|\x86\xca\xc2\x9dGt\xb8Fq\xf1-Y\x91\xed\x97\xb7\x0f\xc8n\xd8\x8dD\xfb\xcd\xaej\xd0\x05-\xdeJ\xa0>\x0c\xdeL\xd6t\x0b+\x1d\xb6\xc1\x92!\xf7=K-\x822XU\xe7\x82~\xa9\x16a\x99U\x87\xd9ZP\xce\x86X1uX\xb2f\xea64\x13\xa6Va\xd4\xd4\x9f\x95[\xb1)\xb7\xaav\x0b\xb8\x96v\xfc\xa6fU`\xa7\xd2W\xb5\xe2\xba\x0fxM\xbe\x9f!\x12\xbd\x9c3\xcc\x924\x1d\xdd\x97\xb1\'\x9d\x1ej\xb3e\x14\x9e\x05\xc3\rs\xd9\xc7\xba\x7f\x95\x7f\x15\x1d\xc1S\xf0\n|G\xf0\xe4\x98\xc5\xf7q>|7Z\x81\xb1\xd6\xf7|[\xff\x1b\xea\xc8\x9a\xbe\xa2\x8f\xe8\xd0\x0e\xcf\xf8*\xf9\xca\x88\xec\xc9\x1f\xf4_\xae\xc9\xff\x00\x99\xdc\xb2m\nendstream\nendobj\n17 0 obj\n4466\nendobj\n14 0 obj\n<< /Type /Font\n/Subtype /CIDFontType2\n/BaseFont /DejaVuSerif\n/CIDSystemInfo << /Registry (Adobe) /Ordering (Identity) /Supplement 0 >>\n/FontDescriptor 12 0 R\n/CIDToGIDMap /Identity\n/W [0 [600 636 460 730 564 402 478 596 602 337 318 390 390 636 ]\n]\n>>\nendobj\n15 0 obj\n<< /Length 455 >>\nstream\n/CIDInit /ProcSet findresource begin\n12 dict begin\nbegincmap\n/CIDSystemInfo << /Registry (Adobe) /Ordering (UCS) /Supplement 0 >> def\n/CMapName /Adobe-Identity-UCS def\n/CMapType 2 def\n1 begincodespacerange\n<0000> <FFFF>\nendcodespacerange\n2 beginbfrange\n<0000> <0000> <0000>\n<0001> <000D> [<007B> <0022> <0045> <0078> <0074> <0072> <0061> <006F> <003A> <0009> <005B> <005D> <007D> ]\nendbfrange\nendcmap\nCMapName currentdict /CMap defineresource pop\nend\nend\n\nendstream\nendobj\n7 0 obj\n<< /Type /Font\n/Subtype /Type0\n/BaseFont /DejaVuSerif\n/Encoding /Identity-H\n/DescendantFonts [14 0 R]\n/ToUnicode 15 0 R>>\nendobj\n16 0 obj\n<<\n/Length 2\n>>\nstream\n\xff\xfc\nendstream\nendobj\n3 0 obj\n<<\n/Type /Pages\n/Kids \n[\n6 0 R\n]\n/Count 1\n/ProcSet [/PDF /Text /ImageB /ImageC]\n>>\nendobj\nxref\n0 18\n0000000000 65535 f \n0000000015 00000 n \n0000000169 00000 n \n0000006915 00000 n \n0000000218 00000 n \n0000000313 00000 n \n0000000350 00000 n \n0000006726 00000 n \n0000000670 00000 n \n0000001078 00000 n \n0000000484 00000 n \n0000000650 00000 n \n0000001097 00000 n \n0000001373 00000 n \n0000005952 00000 n \n0000006219 00000 n \n0000006863 00000 n \n0000005931 00000 n \ntrailer\n<<\n/Size 18 \n/Info 1 0 R\n/Root 2 0 R\n>>\nstartxref\n7013 \n%%EOF\n'
file_upload_response = {'ResponseMetadata': {'RequestId': 'HYAR9MEP80BA602T', 'HostId': 'qlLi121o24mvY7a6wt+UOF/+jjRSnjs1wjigKmMPXBoBgaJTZjsQxZZ8t2Ef+JxL4Zr+VBTzThE=', 'HTTPStatusCode': 200, 'HTTPHeaders': {'x-amz-id-2': 'qlLi121o24mvY7a6wt+UOF/+jjRSnjs1wjigKmMPXBoBgaJTZjsQxZZ8t2Ef+JxL4Zr+VBTzThE=', 'x-amz-request-id': 'HYAR9MEP80BA602T', 'date': 'Mon, 02 May 2022 23:26:32 GMT', 'etag': '"9ed2d0609edb7de1bc406ef0c51f933d"', 'server': 'AmazonS3', 'content-length': '0'}, 'RetryAttempts': 0}, 'ETag': '"9ed2d0609edb7de1bc406ef0c51f933d"'}
generate_path_response = 'None/statements/2022-03-08-2022-03-28.pdf'
file_link_stub = 'https://brokerage-note-and-bank-statement.s3.amazonaws.com/None/statements/2022-03-08-2022-03-28.pdf?AWSAccessKeyId=AKIATZVFXI25USQWCS5O&Signature=c5gpldqihQkqkfCP6PB%2FpsMisks%3D&Expires=1651534184'

@pytest.mark.asyncio
@patch.object(FileRepository, 'upload_file', return_value=file_upload_response)
@patch.object(RequestStatement, 'generate_path', return_value=generate_path_response)
@patch.object(OracleBaseRepository, 'get_data', return_value=[])
async def test_when_right_params_are_sent_to_generate_pdf_function_then_return_the_expected(
        mock_upload_file, mock_generate_path, mock_get_data
):
    RequestStatement.s3_singleton.generate_file_link = file_link_stub
    response = await RequestStatement.get_service_response(MagicMock(region=MagicMock(value='BR'),
                                                               start_date=1646757399000, end_date=1648485399000),
                                                     jwt_data=payload_data_dummy)
    assert response == request_bank_statement_pdf_dummy
